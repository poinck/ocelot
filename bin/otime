#!/bin/bash
#
# otime provides day of the week, week number, time, day of month and month
# for the ocelot side-panel
#
#    ^   ^
#  +-------+
#  |  o_O  |
#  |  >.<  |__/
#  +-------+
#
# ocelot by AndrÃ© Klausnitzer, CC0

source ${OCELOT_PATH}bin/outils.sh

otime_content=""
get_otime() {
    #year_left_margin=$(( SCALE*23 ))
    #time_left_margin=$(( SCALE*20 ))
    hour=$(date '+%-H')
    minute=$(date '+%M')
    minute2=$(date '+%-M')
    minute_percent=$(( minute2*100/60 ))
    hour_percent=$(( hour*100/24 ))
    day=$(date '+%-d')
    day_percent=$(( day*100/31 ))
    month=$(date '+%-m')
    month_percent=$(( month*100/12 ))

    otime1_content="time ^fg(#${cfont})$hour^fg(#${cdarkfont}):^fg(#${cfont})$minute ${cdarkgrey} ${hour_percent} $cdarkblue ${minute_percent} $cdarkpurple"
    otime_content="dayweek ^fg(#${cfont})$(date '+%a')_^fg(#${cdarkfont})$(date '+W%-W') $cdarkgrey"
    otime3_content="date ^fg(#${cfont})${day}_^fg(#${cdarkfont})$(date '+%b') $cdarkgrey ${month_percent} $cdarkblue ${day_percent} $cdarkpurple"
    otime2_content="year ^fg(#${cdarkfont})$(date '+%Y') $cdarkgrey"
}

ofifo="/tmp/ocollector.fifo$OCELOT_INSTANCE"
while true ; do
    get_otime

    #echo "[DEBUG] $otime1_content"
    echo "$otime1_content" > "$ofifo"
    echo "$otime_content" > "$ofifo"
    echo "$otime3_content" > "$ofifo"
    echo "$otime2_content" > "$ofifo"
    sleep 14
done
